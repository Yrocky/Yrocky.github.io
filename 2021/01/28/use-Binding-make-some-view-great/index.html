<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>Yrocky's blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"></head><body><div class="wrap"><nav class="page-navigation"><div class="nav-container"><div class="page-header-logo"><h1 class="prince-log"><a href="/" class="home-link">Yrocky</a></h1></div><button type="button" data-toggle="collapse" data-target=".main-nav-items" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><ul class="collapse navbar-collapse main-nav-items"><li class="menu-item"><a href="/" target="_self">HOME</a></li><li class="menu-item"><a href="/archives/" target="_self">ARCHIVE</a></li></ul></div></nav><main class="prince-container"><div class="post"><article class="post-block"><h1 class="post-title">使用Binding创建符合SwiftUI设计理念的组件</h1><div class="post-info">2021 1月 28日</div><div class="post-entry"><p>SwiftUI中的<code>Binding</code>为我们提供了双向绑定的功能，来确保View内部与外部的数据具备一致性，并且在系统组件中也有很多的应用。除了最基本的在<code>TextField</code>中使用<code>Binding&lt;String&gt;</code>来传递字符串数据、在<code>Toggle</code>中使用<code>Binding&lt;Bool&gt;</code>来记录当前开关状态，还有其他很多使用，比如在<code>Picker</code>中使用<code>Binding&lt;SelectionValue:Hashable&gt;</code>来记录当前选中项、在<code>TabView</code>中使用<code>Binding&lt;SelectionValue:Hashable&gt;?</code>来决定当前哪个TabItem是在屏幕上活跃的、为拓展Present视图的<code>sheet</code>方法中的<code>Binding&lt;Item:Identifiable?&gt;</code>等等。</p>
<p>在最开始使用SwiftUI构建功能组件的时候，往往会沿用在UIKit中的构建思路。编写的组件虽说也是可以使用，但是不论在api的简洁性上，还是在具体实现上都与系统提供的差一些意思。虽然SwiftUI为我们提供的组件有很多，但是细看归类还是可以发现大部分还是有一定设计规范的，比如数据传递中对Binding的运用，从上面列举的一部分就可以发现在某些场景下会使用对应的模式。本文会对系统提供的Binding进行应用场景的归类，接着结合两个具体的开发实例来讨论下如何编写符合SwiftUI设计理念的组件。</p>
<a id="more"></a>
<h2 id="Binding">Binding</h2><blockquote>
<p>这部分内容是从<a href="https://fivestars.blog/swiftui/swiftui-patterns-bindings.html" target="_blank" rel="noopener">https://fivestars.blog/swiftui/swiftui-patterns-bindings.html</a> 这篇文章中总结出来的，具体内容可以参考链接文章。</p>
</blockquote>
<p>在SwiftUI中，对Binding的应用可以分为如下图中的几种类型，从常用的对String、Bool类型的绑定，到可选绑定等等。这些对Binding的应用中有些还会使用protocol来限制数据类型，使用何种协议一般都是与具体控件的含义有关联的。</p>
<img src="/2021/01/28/use-Binding-make-some-view-great/Binding_patterns.png" title="Binding_patterns">
<p>借用文章中的话总结一下在SwiftUI中使用Binding的一些规范：</p>
<ul>
<li>使用<code>value:Binding&lt;V&gt;</code>来绑定需要持续记录的数据，比如Stepper<ul>
<li>特殊的，还可以为V指定某些protocol来约束使用，比如上面的Slider、TextField</li>
<li><code>text: Binding&lt;String&gt;</code>算是一种的特殊情况，限制了需要绑定的类型为String，主要用在具有文字输入的组件中，比如TextField、SecureField、TextEditor</li>
</ul>
</li>
<li><code>selection: Binding&lt;...&gt;</code>主要应用在组件有子组件可被选择的时候<ul>
<li>可以使用protocol来约束被绑定的数据类型，并且会提供一个叫做<code>SelectionValue</code>的泛型，比如Picker中的<code>Binding&lt;SelectionValue: Hashable&gt;</code></li>
<li>当可被选择的类型可以确定的时候，直接使用类型，其实是上一种情况的特例，比如ColorPicker、DatePicker</li>
<li>选择的元素还可以被取消，这时候就需要绑定一个可选类型的数据，比如NavigationLink中的<code>Binding&lt;V?&gt;</code></li>
<li>甚至有时候都不一定需要绑定，这时候整个Binding都是可选类型的，比如TabView中的<code>Binding&lt;SelectionValue&gt;?</code></li>
<li>上面说的是只有一个可选项，当有多个可选项的时候，可以使用集合来作为数据类型，比如List中的<code>Binding&lt;Set&lt;SelectionValue&gt;&gt;</code></li>
<li>甚至多个可选项的时候，整个Binding都是可选类型的，比如List中的<code>Binding&lt;Set&lt;SelectionValue&gt;&gt;?</code></li>
</ul>
</li>
<li><code>is...: Binding&lt;Bool&gt;</code>用来记录yes、no两种情况，他们都有一个共同点，参数以<code>is</code>开始，拼接组件对应的状态，比如Toggle中的<code>isOn: Binding&lt;Bool&gt;</code></li>
<li>在SwiftUI中没有任何一个组件会有两个Binding的参数</li>
</ul>
<h2 id="Hashlabe">Hashlabe</h2><p>假如我们需要根据Toggle来实现一个具有互斥功能的开关组，很容易想到的方案是自定义Binding的<code>get</code>与<code>set</code>方法，在内部做逻辑上的互斥，然后根据使用@State标记的布尔值更新Toggle。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> option_one = <span class="literal">true</span></span><br><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> option_two = <span class="literal">false</span></span><br><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> option_three = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> binging_one = <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;(</span><br><span class="line">    <span class="keyword">get</span>: &#123; <span class="keyword">return</span> option_one &#125;,</span><br><span class="line">    <span class="keyword">set</span>: &#123;</span><br><span class="line">        <span class="keyword">self</span>.option_one = $<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> $<span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.option_two = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">self</span>.option_three = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">let</span> binging_two = <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;(</span><br><span class="line">    <span class="keyword">get</span>: &#123; <span class="keyword">return</span> option_two &#125;,</span><br><span class="line">    <span class="keyword">set</span>: &#123;</span><br><span class="line">        <span class="keyword">self</span>.option_two = $<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> $<span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.option_one = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">self</span>.option_three = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">let</span> binging_three = <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;(</span><br><span class="line">    <span class="keyword">get</span>: &#123; <span class="keyword">return</span> option_three &#125;,</span><br><span class="line">    <span class="keyword">set</span>: &#123;</span><br><span class="line">        <span class="keyword">self</span>.option_three = $<span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> $<span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.option_one = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">self</span>.option_two = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">Toggle</span>(<span class="string">"Option one"</span>, isOn: binging_one)</span><br><span class="line"></span><br><span class="line">    <span class="type">Toggle</span>(<span class="string">"Option two"</span>, isOn: binging_two)</span><br><span class="line"></span><br><span class="line">    <span class="type">Toggle</span>(<span class="string">"Option three"</span>, isOn: binging_three)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样确实是实现了具有互斥功能的需求，但却会导致拓展性很差，并且很多重复逻辑也导致代码非常冗余，这时候我们就需要考虑下使用一种更优雅的方法来实现互斥需求。</p>
<p>我们知道，<code>TabView</code>是SwiftUI中具有互斥功能的系统组件，我们可以借鉴它来优化Toggle的互斥方案。</p>
<p>TabView可以使用<code>selection</code>来记录哪个TabItem被选中，通过头文件我们知道，它是<code>Binding&lt;SelectionValue&gt;</code>类型的，而<code>SelectionValue</code>又必须遵守<code>Hashable</code>协议。Hashable就表示具有唯一性，TabView就是根据这个特性来决定选中TabItem的，这个也正好可以应用到我们具有互斥功能的Toggle中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TabView</span>&lt;<span class="title">SelectionValue</span>, <span class="title">Content</span>&gt; : <span class="title">View</span> <span class="title">where</span> <span class="title">SelectionValue</span> : <span class="title">Hashable</span>, <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">init</span>(selection: <span class="type">Binding</span>&lt;<span class="type">SelectionValue</span>&gt;?, @<span class="type">ViewBuilder</span> content: () -&gt; <span class="type">Content</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个使用TabView的例子如下，我们为TabView提供了三个界面，并使用一个enum来作为每个界面的可选tag，默认会选中第三个界面（View C）：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">TabItemOption</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selectionOption: <span class="type">TabItemOption</span> = .three</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">TabView</span>(selection: $selectionOption) &#123;</span><br><span class="line">        <span class="type">PageView</span>(text: <span class="string">"View A"</span>, color: .orange)</span><br><span class="line">            .tabItem &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"A"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .tag(<span class="type">TabItemOption</span>.one)</span><br><span class="line"></span><br><span class="line">        <span class="type">PageView</span>(text: <span class="string">"View B"</span>, color: .green)</span><br><span class="line">            .tabItem &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"B"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .tag(<span class="type">TabItemOption</span>.two)</span><br><span class="line"></span><br><span class="line">        <span class="type">PageView</span>(text: <span class="string">"View C"</span>, color: .pink)</span><br><span class="line">            .tabItem &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"C"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .tag(<span class="type">TabItemOption</span>.three)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video src="./TabView.mp4" type="video/mp4" controls="controls" autoplay="autoplay" loop="loop" width="100%" height="100%"><br></video>

<p>虽然我们不知道在TabView中是如何根据tag、selection来决定选中哪一个TabItem的，但是我们可以借鉴这种形式来拓展Toggle。类似的，我们期望为每一个Toggle设置一个tag，并且tag是具有Hashable特性的，让具有互斥性的多个Toggle共用同一个isOn（<code>Binding&lt;Bool&gt;</code>类型），至于具体的互斥逻辑还是上面我们一开始实现的逻辑。具体实现如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Toggle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">Hashable</span>&gt;(</span><br><span class="line">        isOn: <span class="type">Binding</span>&lt;<span class="type">T</span>?&gt;,</span><br><span class="line">        tag: <span class="type">T</span>,</span><br><span class="line">        @<span class="type">ViewBuilder</span> label: () -&gt; <span class="type">Label</span></span><br><span class="line">    )&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> selectionValue: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt; = <span class="type">Binding</span>(</span><br><span class="line">            <span class="keyword">get</span>: &#123;</span><br><span class="line">                isOn.wrappedValue == tag</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">set</span>: &#123;</span><br><span class="line">                <span class="keyword">if</span> $<span class="number">0</span> &#123;</span><br><span class="line">                    isOn.wrappedValue = tag</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    isOn.wrappedValue = <span class="literal">nil</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(isOn: selectionValue, label: label)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们来使用拓展的Toggle，使用具有Hashable的枚举来区分每个Toggle。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ToggleOption</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> one, two, three</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后使用我们拓展的初始化方法，创建成组的Toggle，这次我们只需要一个使用State标记的变量即可，这极大的简化了我们的业务逻辑。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> selectionOption: <span class="type">ToggleOption</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Toggle</span>(isOn: $selectionOption, tag: <span class="type">ToggleOption</span>.one) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Option one"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Toggle</span>(isOn: $selectionOption, tag: <span class="type">ToggleOption</span>.two) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Option two"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Toggle</span>(isOn: $selectionOption, tag: <span class="type">ToggleOption</span>.three) &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="string">"Option three"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<video src="./MutualExclusionToggle.mp4" type="video/mp4" controls="controls" autoplay="autoplay" loop="loop" width="100%" height="100%"><br></video>

<h2 id="Optional">Optional</h2><p>Binding为我们提供了双向绑定，确保外部、内部数据的状态是一致的，比如Toggle中使用<code>Binding&lt;Bool&gt;</code>来同步开关的状态。但有些时候外部可能并不关心数据的变动，举一个不恰当的例子就是Toggle组件的开关状态不与外部同步，这种情况下，Toggle初始化的时候就不需要<code>isOn</code>参数。在SwiftUI中DisclosureGroup有两个初始化方法，一个需要传递<code>Binding&lt;Bool&gt;</code>将状态与外部同步，一个不需要传递：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DisclosureGroup</span>&lt;<span class="title">Label</span>, <span class="title">Content</span>&gt; : <span class="title">View</span> <span class="title">where</span> <span class="title">Label</span> : <span class="title">View</span>, <span class="title">Content</span> : <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(@<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>, @<span class="type">ViewBuilder</span> label: () -&gt; <span class="type">Label</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(isExpanded: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;, @<span class="type">ViewBuilder</span> content: @escaping () -&gt; <span class="type">Content</span>, @<span class="type">ViewBuilder</span> label: () -&gt; <span class="type">Label</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们借助这种形式实现一个组件，提供<strong>需要Binding</strong>以及<strong>不需要Binding</strong>的两种初始化方法。</p>
<img src="/2021/01/28/use-Binding-make-some-view-great/BlurImageView.png" title="BlurImageView">
<p>假如我们有一个为图片增加Blur效果的组件<strong>BlurImageView</strong>，可以通过点击实现图片在正常与Blur之间切换，我们可以很容易写出如下代码。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlurImageView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(imageName: <span class="type">String</span>, isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.imageName = imageName</span><br><span class="line">        <span class="keyword">self</span>.isBlur = isBlur</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(imageName)</span><br><span class="line">            <span class="comment">// 省略一些修饰代码</span></span><br><span class="line">            .blur(radius: isBlur.wrappedValue ? <span class="number">10</span> : <span class="number">0</span>)</span><br><span class="line">            .onTapGesture &#123;</span><br><span class="line">                withAnimation &#123;</span><br><span class="line">                    <span class="keyword">self</span>.isBlur.wrappedValue.toggle()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该组件需要外部提供图片名称，以及当前是否处于Blur效果的<code>Binding&lt;Bool&gt;</code>绑定，因此我们只需要在业务中如下编写代码，使用@State提供需要的Binding即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> isBlur: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">    <span class="type">BlurImageView</span>(imageName: <span class="string">"gods"</span>, isBlur: $isBlur)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如我们前面所说，有些情况下，我们使用该组件的时候并不关心它是否处于Blur状态下，换句话说就是，BlurImageView的isBlur状态只需要在内部维护就好。虽然我们可以创建一个@State，放着不用，但是这样并不优雅。我们需要的是一个专门用于这种应用场景的方案，是一个<strong>不需要传递Binding</strong>的初始化方法，比如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">    <span class="type">BlurImageView</span>(imageName: <span class="string">"gods"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但由于我们在BlurImageView内部需要记录是否处于Blur状态，所以必定需要一个<code>source of truth</code>，在前面它是从外部的<code>$isBlur</code>提供的，如果外部不提供，我们就需要自己在内部提供一个，同时还需要创建一个相应的init方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlurImageView</span>: <span class="title">View</span> </span>&#123;   </span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> innerIsBlur: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">init</span>(imageName: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.imageName = imageName</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但这有个问题，我们的BlurImageView中的<code>isBlur</code>变量是必须初始化的，这时候我们可以多添加一层，将接口部分放到容器。我们将核心方法放入私有组件中，提供一个与示例中一样的容器View来承载是否需要外部Binding的功能，并为容器组件提供多个初始化方法：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BlurImageView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 内部私有的source of truth</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> innerIsBlur: <span class="type">Bool</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(imageName: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.imageName = imageName</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(imageName: <span class="type">String</span>, isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.imageName = imageName</span><br><span class="line">        <span class="keyword">self</span>.isBlur = isBlur</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">Inner</span>(</span><br><span class="line">            imageName: imageName,</span><br><span class="line">            isBlur: isBlur ?? $innerIsBlur<span class="comment">// 如果外部没有提供Binding，就使用内部的innerIsBlur生成的Binding</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">struct</span> <span class="title">Inner</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> imageName: <span class="type">String</span></span><br><span class="line">        <span class="keyword">var</span> isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">init</span>(imageName: <span class="type">String</span>, isBlur: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;) &#123;</span><br><span class="line">            <span class="keyword">self</span>.imageName = imageName</span><br><span class="line">            <span class="keyword">self</span>.isBlur = isBlur</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">            <span class="type">Image</span>(imageName)</span><br><span class="line">                <span class="comment">// 省略一些修饰代码</span></span><br><span class="line">                .blur(radius: isBlur.wrappedValue ? <span class="number">10</span> : <span class="number">0</span>)</span><br><span class="line">                .onTapGesture &#123;</span><br><span class="line">                    withAnimation &#123; <span class="keyword">self</span>.isBlur.wrappedValue.toggle() &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样一来，我们就可以灵活的使用我们的BlurImageView了。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> isBlur: <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">VStack</span>(spacing: <span class="number">20</span>)&#123;</span><br><span class="line">        <span class="comment">// 使用内部私有的Binding</span></span><br><span class="line">        <span class="type">BlurImageView</span>(imageName: <span class="string">"gods"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="comment">// 使用外部提供的Binding</span></span><br><span class="line">            <span class="type">BlurImageView</span>(imageName: <span class="string">"gods"</span>, isBlur: $isBlur)</span><br><span class="line"></span><br><span class="line">            <span class="type">Button</span>(<span class="string">"Make Image <span class="subst">\(!isBlur ? "Blur" : "Normal")</span>"</span>) &#123;</span><br><span class="line">                withAnimation &#123; isBlur.toggle() &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<video src="./BlurImageView.mp4" type="video/mp4" controls="controls" autoplay="autoplay" loop="loop" width="100%" height="100%"><br></video>


<h2 id="参考文章">参考文章</h2><ul>
<li>参考文章列表</li>
</ul>
</div><div class="post-tags-box"><a class="tag-link" href="/tags/SwiftUI/">SwiftUI</a>, <a class="tag-link" href="/tags/iOS开发/">iOS开发</a></div></article></div><div class="post-nav"><div class="next-wrap col-md-6 col-xs-6 col-md-offset-6 col-xs-offset-6"><a href="/2021/01/15/state-and-data-flow/" class="next-post">SwiftUI中的Data Flow（二）</a><i class="fa fa-angle-double-right"></i></div></div></main></div><footer><div class="copyright"><p>Crafted with <i class="fa fa-heart"></i> by&nbsp;Yrocky&nbsp;|&nbsp;<a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yiliashaw/hexo-theme-prince" target="_blank">Prince</a> by SHAW</p></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.0.47/jquery.fancybox.min.js"></script><script src="/js/script.js"></script></body></html>